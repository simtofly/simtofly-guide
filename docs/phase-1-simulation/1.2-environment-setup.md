# 1.2 Environment Setup

## What You'll Learn

Prepare your Ubuntu system for drone development:
- âœ… Update and configure your system
- âœ… Install essential development tools
- âœ… Configure terminal for efficiency
- âœ… Create organized workspace structure
- âœ… Verify everything is ready for ArduPilot SITL

**Time:** 30-45 minutes

---

## Prerequisites

Before starting, you must have completed:
- âœ… [1.1 Prerequisites and Setup](1.1-prerequisites.md)
- âœ… Ubuntu 22.04 LTS installed and booted
- âœ… Internet connection working
- âœ… System meets minimum requirements

---

## ğŸ”„ Update Your System

### Why Update First?

Before installing anything, ensure your system has:
- Latest security patches
- Updated package repositories
- Bug fixes and improvements

**This prevents compatibility issues later.**

### Update Commands

Open terminal (Ctrl+Alt+T) and run:
```bash
sudo apt update
```

**What this does:** Updates the list of available packages and versions.

**Expected output:**
```
Hit:1 http://archive.ubuntu.com/ubuntu jammy InRelease
Get:2 http://archive.ubuntu.com/ubuntu jammy-updates InRelease [119 kB]
...
Reading package lists... Done
```

âœ… **Success:** No errors, shows "Reading package lists... Done"

---

Now upgrade installed packages:
```bash
sudo apt upgrade -y
```

**What this does:** Actually downloads and installs updates.

**This takes:** 5-15 minutes depending on how many updates available.

**Expected output:**
```
Reading package lists... Done
Building dependency tree... Done
...
The following packages will be upgraded:
  [list of packages]
...
Setting up [package names]...
```

âœ… **Success:** Completes without errors

---

### Clean Up

Remove unnecessary packages:
```bash
sudo apt autoremove -y
sudo apt autoclean
```

**What this does:** Frees disk space by removing unused packages.

---

### Reboot (Important!)
```bash
sudo reboot
```

**Why reboot?** Kernel updates require restart to take effect.

**After reboot:** Open terminal again and continue.

---

## ğŸ› ï¸ Install Essential Development Tools

### Build Tools

ArduPilot needs these to compile:
```bash
sudo apt install -y build-essential git
```

**What these are:**
- `build-essential` â€” C/C++ compiler and libraries
- `git` â€” Version control (download ArduPilot source)

**Verify installation:**
```bash
gcc --version
git --version
```

**Expected output:**
```
gcc (Ubuntu 11.x.x) ...
git version 2.34.x
```

âœ… **Success:** Both show version numbers

---

### Python and Tools

ArduPilot SITL uses Python:
```bash
sudo apt install -y python3 python3-pip python3-dev
```

**Verify Python:**
```bash
python3 --version
pip3 --version
```

**Expected output:**
```
Python 3.10.x
pip 22.x.x from ...
```

âœ… **Success:** Python 3.10+ and pip installed

---

### Additional Dependencies

Install tools we'll need throughout the tutorial:
```bash
sudo apt install -y \
    curl \
    wget \
    nano \
    net-tools \
    openssh-client \
    software-properties-common
```

**What these are:**
- `curl`, `wget` â€” Download files from internet
- `nano` â€” Simple text editor
- `net-tools` â€” Network diagnostics
- `openssh-client` â€” SSH connections (for RPi later)
- `software-properties-common` â€” Manage software repositories

---

## ğŸ–¥ï¸ Configure Your Terminal

### Make Terminal More Useful

#### Enable Color Prompt

Check if already enabled:
```bash
cat ~/.bashrc | grep "force_color_prompt=yes"
```

**If nothing appears**, enable it:
```bash
sed -i 's/#force_color_prompt=yes/force_color_prompt=yes/' ~/.bashrc
source ~/.bashrc
```

**Result:** Your terminal prompt now shows colors (easier to read).

---

#### Add Useful Aliases

Add shortcuts for common commands:
```bash
nano ~/.bashrc
```

**Scroll to bottom and add these lines:**
```bash
# Useful aliases for SimToFly tutorials
alias ll='ls -lah'
alias update='sudo apt update && sudo apt upgrade -y'
alias workspace='cd ~/simtofly_ws'

# Show current git branch in prompt (useful later)
parse_git_branch() {
    git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/(\1)/'
}
export PS1="\u@\h:\w\$(parse_git_branch)\$ "
```

**Save and exit:** Ctrl+X, then Y, then Enter

**Apply changes:**
```bash
source ~/.bashrc
```

**Test your new aliases:**
```bash
ll
```

âœ… **Success:** Shows detailed file listing with sizes

---

### Increase Terminal History

Keep more command history (useful for finding previous commands):
```bash
echo 'HISTSIZE=10000' >> ~/.bashrc
echo 'HISTFILESIZE=20000' >> ~/.bashrc
source ~/.bashrc
```

**What this does:** Saves last 10,000 commands instead of default 500.

---

## ğŸ“ Create Workspace Structure

### Why Organized Workspace?

Having a clear structure prevents:
- âŒ Files scattered everywhere
- âŒ Forgetting where you saved things
- âŒ Conflicts between different projects

### Create Main Workspace
```bash
mkdir -p ~/simtofly_ws
cd ~/simtofly_ws
```

**What this creates:** Main folder for all SimToFly work.

---

### Create Subdirectories
```bash
cd ~/simtofly_ws
mkdir -p {ardupilot,logs,missions,scripts,ros2_ws}
```

**What each folder is for:**
- `ardupilot/` â€” ArduPilot source code (we'll clone here)
- `logs/` â€” Flight logs and data
- `missions/` â€” Mission files and waypoints
- `scripts/` â€” Helper scripts and tools
- `ros2_ws/` â€” ROS2 workspace (Phase 2)

**Verify structure:**
```bash
tree -L 1 ~/simtofly_ws
```

**Expected output:**
```
/home/your-username/simtofly_ws
â”œâ”€â”€ ardupilot
â”œâ”€â”€ logs
â”œâ”€â”€ missions
â”œâ”€â”€ ros2_ws
â””â”€â”€ scripts

5 directories, 0 files
```

âœ… **Success:** All directories created

**If `tree` command not found:**
```bash
sudo apt install -y tree
```

---

### Add Workspace to Your Path

Make it easy to jump to workspace from anywhere:
```bash
echo 'export SIMTOFLY_WS=~/simtofly_ws' >> ~/.bashrc
source ~/.bashrc
```

**Test it:**
```bash
echo $SIMTOFLY_WS
cd $SIMTOFLY_WS
pwd
```

**Expected output:**
```
/home/your-username/simtofly_ws
/home/your-username/simtofly_ws
```

âœ… **Success:** Can access workspace via variable

---

## ğŸ”’ Configure Git (Optional but Important for Later)

Set your identity for git commits:
```bash
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"
```

**Replace with your actual name and email.**

**Verify configuration:**
```bash
git config --list | grep user
```

**Expected output:**
```
user.name=Your Name
user.email=your.email@example.com
```

âœ… **Success:** Git configured

**Why this matters:** Later you might contribute fixes or fork repositories.

---

## ğŸ§ª System Check and Verification

### Create Verification Script

Let's create a script to check everything is ready:
```bash
nano ~/simtofly_ws/scripts/check_environment.sh
```

**Paste this script:**
```bash
#!/bin/bash

echo "=========================================="
echo "SimToFly Environment Check"
echo "=========================================="
echo ""

# Check Ubuntu version
echo "Checking Ubuntu version..."
if lsb_release -d | grep -q "22.04"; then
    echo "âœ… Ubuntu 22.04 detected"
else
    echo "âŒ Wrong Ubuntu version. Need 22.04"
    lsb_release -d
fi
echo ""

# Check disk space
echo "Checking disk space..."
AVAILABLE=$(df -BG / | tail -1 | awk '{print $4}' | sed 's/G//')
if [ "$AVAILABLE" -gt 30 ]; then
    echo "âœ… Sufficient disk space: ${AVAILABLE}GB available"
else
    echo "âš ï¸  Low disk space: ${AVAILABLE}GB available (need 30GB+)"
fi
echo ""

# Check RAM
echo "Checking RAM..."
TOTAL_RAM=$(free -g | awk '/^Mem:/{print $2}')
if [ "$TOTAL_RAM" -ge 7 ]; then
    echo "âœ… Sufficient RAM: ${TOTAL_RAM}GB"
else
    echo "âš ï¸  Low RAM: ${TOTAL_RAM}GB (recommended 8GB+)"
fi
echo ""

# Check essential tools
echo "Checking essential tools..."
TOOLS=("gcc" "g++" "make" "git" "python3" "pip3")
for tool in "${TOOLS[@]}"; do
    if command -v $tool &> /dev/null; then
        echo "âœ… $tool installed"
    else
        echo "âŒ $tool NOT installed"
    fi
done
echo ""

# Check workspace structure
echo "Checking workspace structure..."
DIRS=("ardupilot" "logs" "missions" "scripts" "ros2_ws")
for dir in "${DIRS[@]}"; do
    if [ -d "$HOME/simtofly_ws/$dir" ]; then
        echo "âœ… $dir directory exists"
    else
        echo "âŒ $dir directory missing"
    fi
done
echo ""

# Check internet
echo "Checking internet connection..."
if ping -c 1 google.com &> /dev/null; then
    echo "âœ… Internet connection working"
else
    echo "âŒ No internet connection"
fi
echo ""

echo "=========================================="
echo "Environment check complete!"
echo "=========================================="
```

**Save and exit:** Ctrl+X, then Y, then Enter

---

### Make Script Executable
```bash
chmod +x ~/simtofly_ws/scripts/check_environment.sh
```

---

### Run Verification
```bash
~/simtofly_ws/scripts/check_environment.sh
```

**Expected output:**
```
==========================================
SimToFly Environment Check
==========================================

Checking Ubuntu version...
âœ… Ubuntu 22.04 detected

Checking disk space...
âœ… Sufficient disk space: 45GB available

Checking RAM...
âœ… Sufficient RAM: 8GB

Checking essential tools...
âœ… gcc installed
âœ… g++ installed
âœ… make installed
âœ… git installed
âœ… python3 installed
âœ… pip3 installed

Checking workspace structure...
âœ… ardupilot directory exists
âœ… logs directory exists
âœ… missions directory exists
âœ… scripts directory exists
âœ… ros2_ws directory exists

Checking internet connection...
âœ… Internet connection working

==========================================
Environment check complete!
==========================================
```

âœ… **All checks pass:** Your environment is ready!

âš ï¸ **Some checks fail:** Review and fix issues before continuing.

---

## ğŸ“ Final Checklist

Before moving to next section, verify:

- [ ] âœ… System fully updated (`apt update && upgrade` completed)
- [ ] âœ… Rebooted after updates
- [ ] âœ… Essential tools installed (gcc, git, python3)
- [ ] âœ… Terminal configured with aliases
- [ ] âœ… Workspace structure created (`~/simtofly_ws/`)
- [ ] âœ… Git configured with your name and email
- [ ] âœ… Verification script runs successfully
- [ ] âœ… All checks in verification script pass

**All checked?** You're ready for ArduPilot SITL! ğŸš€

---

## ï¿½ï¿½ What You Accomplished

- âœ… Updated Ubuntu to latest packages
- âœ… Installed development tools (gcc, git, python3)
- âœ… Configured terminal for efficiency
- âœ… Created organized workspace structure
- âœ… Set up git configuration
- âœ… Verified environment is ready
- âœ… Created verification script for future checks

---

## ğŸš€ Next Steps

Continue to **[1.3 ArduPilot SITL Installation](1.3-ardupilot-sitl.md)** where we'll:
- Download ArduPilot source code
- Install ArduPilot dependencies
- Build SITL simulator
- Launch your first virtual drone
- Test basic commands

---

## â“ Common Questions

### Q: Do I need to run the verification script every time?

**A:** No, just once now to confirm setup. But you can run it anytime if something breaks.

### Q: Can I use a different workspace location?

**A:** Yes, but stick with `~/simtofly_ws/` for consistency with this tutorial. Changing locations means adapting all commands.

### Q: The update took very long, is this normal?

**A:** Yes, first update after fresh Ubuntu install can take 15-30 minutes depending on internet speed and pending updates.

### Q: I got errors during `apt upgrade`, what do I do?

**A:** Read the error message carefully. Common fixes:
- Run `sudo apt --fix-broken install`
- Try `sudo dpkg --configure -a`
- Reboot and try again
- Search the specific error online

### Q: Can I skip the terminal customization?

**A:** Yes, it's optional. But aliases and colors make your life easier, especially for beginners.

---

## ğŸ› Troubleshooting

### "Unable to locate package" errors

**Cause:** Package repositories not updated

**Solution:**
```bash
sudo apt update
sudo apt install -y [package-name]
```

---

### "Permission denied" when creating directories

**Cause:** Trying to create in protected location

**Solution:** Make sure you're creating in your home directory (`~/`), not system directories.

---

### Verification script shows "command not found"

**Cause:** Script doesn't have execute permission

**Solution:**
```bash
chmod +x ~/simtofly_ws/scripts/check_environment.sh
```

---

### Terminal changes don't apply

**Cause:** Didn't reload bashrc

**Solution:**
```bash
source ~/.bashrc
```

Or close and reopen terminal.

---

### Git config commands fail

**Cause:** Git not installed

**Solution:**
```bash
sudo apt install -y git
```

---

[â† Back: 1.1 Prerequisites](1.1-prerequisites.md) | [Next: 1.3 ArduPilot SITL â†’](1.3-ardupilot-sitl.md)
